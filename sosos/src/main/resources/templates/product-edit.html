<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>상품 수정</title>
    <link rel="stylesheet" href="/css/style.css">
    <script>
        // 페이지 로드 시 기존 데이터 가져오기
        async function loadProductData() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            try {
                const response = await fetch(`/api/products/${productId}`);
                if (!response.ok) {
                    throw new Error('상품 데이터를 불러오지 못했습니다.');
                }

                const product = await response.json();

                // 기존 데이터 폼에 채우기
                document.getElementById('id').value = product.id;
                document.getElementById('name').value = product.name;
                document.getElementById('category').value = product.category;
                document.getElementById('price').value = product.price;
                document.getElementById('description').value = product.description;
                document.getElementById('situationScore').value = product.situationScore;

                // 상세 설명 이미지가 존재할 경우 미리보기 표시
                if (product.descriptionImageUrl) {
                    const existingImage = document.getElementById('existingDescriptionImage');
                    existingImage.src = product.descriptionImageUrl;
                    existingImage.style.display = 'block';
                }
            } catch (error) {
                alert(error.message);
                document.querySelector('.content').innerHTML = '<p>상품 정보를 불러오지 못했습니다.</p>';
            }
        }

        // 상품 수정
        async function submitForm(event) {
            event.preventDefault();

            const formData = new FormData(document.getElementById('productForm'));
            const productId = formData.get('id');

            try {
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'PUT',
                    body: formData
                });

                if (response.ok) {
                    alert('상품 수정이 완료되었습니다. 목록 페이지로 이동합니다.');
                    window.location.href = '/seller/products';
                } else {
                    const error = await response.text();
                    alert(`상품 수정 실패: ${error}`);
                }
            } catch (error) {
                alert('상품 수정 요청 중 오류가 발생했습니다.');
            }
        }

        document.addEventListener('DOMContentLoaded', loadProductData);
    </script>
</head>
<body>
    <div class="content">
        <h2>상품 수정</h2>
        <form id="productForm" enctype="multipart/form-data" onsubmit="submitForm(event)">
            <!-- 숨겨진 ID 필드 -->
            <input type="hidden" id="id" name="id">

            <!-- 상품 대표 이미지 -->
            <label for="image">대표 이미지:</label>
            <input type="file" id="image" name="image" accept="image/*"><br>

            <!-- 상품명 -->
            <label for="name">상품명:</label>
            <input type="text" id="name" name="name" required><br>

            <!-- 카테고리 -->
            <label for="category">카테고리:</label>
            <select id="category" name="category" required>
                <option value="outer">OUTER</option>
                <option value="top">TOP</option>
                <option value="bottoms">BOTTOMS</option>
                <option value="set_clothes">SET CLOTHES</option>
                <option value="shoes">SHOES</option>
                <option value="bag_acc">BAG & ACC</option>
            </select><br>

            <!-- 가격 -->
            <label for="price">가격:</label>
            <input type="number" id="price" name="price" required><br>

            <!-- 상황별 점수 -->
            <label for="situationScore">상황별 점수:</label>
            <input type="number" id="situationScore" name="situationScore" min="0" max="100" required><br>

            <!-- 상세 설명 -->
            <label for="description">상세 설명:</label>
            <textarea id="description" name="description" rows="5" required></textarea><br>

            <!-- 상세 설명 이미지 -->
            <label for="descriptionImage">상세 설명 이미지:</label>
            <input type="file" id="descriptionImage" name="descriptionImage" accept="image/*"><br>
            <img id="existingDescriptionImage" style="display:none; max-width: 200px; margin-top: 10px;" alt="상세 설명 이미지 미리보기"><br>


            <button type="submit">상품 수정</button>
        </form>
        <button onclick="history.back()">뒤로가기</button>
    </div>
</body>
</html>
