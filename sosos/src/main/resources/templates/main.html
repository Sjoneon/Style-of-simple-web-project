<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë©”ì¸í™”ë©´ - Sos</title>
    <link rel="stylesheet" href="/css/style.css">
    <script>
        // ìƒí’ˆ ëª©ë¡ ì´ˆê¸° ë¡œë“œ
        async function loadProducts() {
            const response = await fetch('/api/products');
            if (response.ok) {
                const products = await response.json();
                renderProducts(products); // ìƒí’ˆ ë Œë”ë§
            } else {
                alert('ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ì¡°íšŒ
        async function fetchProductsByCategory(category) {
            const response = await fetch(`/api/products/category?category=${encodeURIComponent(category)}`);
            if (response.ok) {
                const products = await response.json();
                renderProducts(products);
            } else {
                alert('ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìƒí’ˆ ëª©ë¡ ë Œë”ë§
        function renderProducts(products) {
            const productListDiv = document.querySelector('.product-list');
            productListDiv.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product-item';
                productDiv.innerHTML = `
                    <a href="/api/products/detail?id=${product.id}">
                        <img src="${product.imageUrl}" alt="${product.name}" />
                        <h3>${product.name}</h3>
                        <p>${product.price}ì›</p>
                    </a>
                `;
                productListDiv.appendChild(productDiv);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadProducts(); // ìƒí’ˆ ëª©ë¡ ì´ˆê¸° ë¡œë“œ
        
            // ì‚¬ì´ë“œë°” í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.sidebar nav ul li a').forEach(link => {
                link.addEventListener('click', (event) => {
                    const category = event.target.textContent.trim();
                    
                    // Q&Aë‚˜ SETTINGì€ ê¸°ë³¸ ë™ì‘ í—ˆìš©
                    if (event.target.href.endsWith("/api/orders") || event.target.href.includes("/inquiries")) {
                        return; // ê¸°ë³¸ ë§í¬ ë™ì‘ í—ˆìš©
                    }
        
                    event.preventDefault(); // ê¸°ë³¸ ë§í¬ ë™ì‘ ë°©ì§€
                    if (category === "ALL") {
                        loadProducts();
                    } else {
                        fetchProductsByCategory(category);
                    }
                });
            });
        });            
    </script>
</head>
<body>
    <div class="sidebar">
        <h2>Sos</h2>
        <nav>
            <ul>
                <li><a href="#">ALL</a></li>
                <li><a href="#">BEST</a></li>
                <li><a href="#">OUTER</a></li>
                <li><a href="#">TOP</a></li>
                <li><a href="#">BOTTOMS</a></li>
                <li><a href="#">SET CLOTHES</a></li>
                <li><a href="#">SHOES</a></li>
                <li><a href="#">BAG_ACC</a></li>
            </ul>
            <div class="menu-section">
                <h3>MY</h3>
                <ul>
                    <li><a href="#">NOTICE</a></li>
                    <li><a href="/inquiries">Q&A</a></li>
                    <li><a href="/api/orders">SETTING</a></li>
                </ul>
            </div>
        </nav>
    </div>
    
    <div class="content">
        <div class="top-bar">
            <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ UI í‘œì‹œ -->
            <div th:if="${session.loggedInUser != null}">
                <span th:if="${session.userType == 'user'}">ì•ˆë…•í•˜ì„¸ìš”, <span th:text="${session.loggedInUser.name}"></span>ë‹˜!</span>
                <span th:if="${session.userType == 'seller'}">ì•ˆë…•í•˜ì„¸ìš”, <span th:text="${session.loggedInUser.businessName}"></span>ë‹˜!</span>
                <a href="/users/logout"> ë¡œê·¸ì•„ì›ƒ</a>
                <a href="/api/products/cart"> ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a> <!-- ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ì¥ë°”êµ¬ë‹ˆ -->
            </div>
            <div th:if="${session.loggedInUser == null}">
                <a href="/users/login"> ğŸ”‘ ë¡œê·¸ì¸</a>
                <a href="/users/register"> ğŸ“ íšŒì›ê°€ì…</a>
                <a href="#" onclick="alert('íšŒì›ê°€ì…ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.')"> ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</a> <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->
            </div>
        </div>
        
        
        <div class="product-list">
            <!-- ë™ì ìœ¼ë¡œ ìƒí’ˆì´ í‘œì‹œë©ë‹ˆë‹¤. -->
        </div>
    </div>
</body>
</html>
